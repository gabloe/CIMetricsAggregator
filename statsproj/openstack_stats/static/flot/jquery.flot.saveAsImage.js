;(function($,Canvas2Image){var imageCreated=null;function init(plot,classes){plot.hooks.bindEvents.push(bindEvents);plot.hooks.shutdown.push(shutdown);function bindEvents(plot,eventHolder){eventHolder.mousedown(onMouseDown)}function shutdown(plot,eventHolder){eventHolder.unbind("mousedown",onMouseDown)}function onMouseDown(e){if(e.button==2){deleteStaleCanvasImage(plot);createImageFromCanvas(plot,plot.getOptions().imageFormat);setTimeout(function(){deleteStaleCanvasImage(plot)},500)}}}function onMouseUp(plot){setTimeout(function(){deleteStaleCanvasImage(plot)},100)}function deleteStaleCanvasImage(plot){$(imageCreated).unbind("mouseup",onMouseUp).remove()}function createImageFromCanvas(plot,format){var canvas=plot.getCanvas();var img=null;switch(format.toLowerCase()){case"png":img=Canvas2Image.saveAsPNG(canvas,format);break;case"bmp":img=Canvas2Image.saveAsBMP(canvas,format);break;case"jpeg":img=Canvas2Image.saveAsJPEG(canvas,format);break;default:break}if(!img){img=Canvas2Image.saveAsPNG(canvas,"png")}if(!img){img=Canvas2Image.saveAsPNG(canvas,"bmp")}if(!img){img=Canvas2Image.saveAsJPEG(canvas,"jpeg")}if(!img){alert(plot.getOptions().notSupportMessage||"Oh Sorry, but this browser is not capable of creating image files, please use PRINT SCREEN key instead!");return false}$(img).attr("class",plot.getOptions().imageClassName);$(img).css({border:$(canvas).css("border"),"z-index":"9999",position:"absolute"});$(img).insertBefore($(canvas));$(img).mouseup(plot,onMouseUp);imageCreated=img}var options={imageClassName:"canvas-image",imageFormat:"png"};$.plot.plugins.push({init:init,options:options,name:'saveAsImage',version:'1.2'})})(jQuery,Canvas2Image)